<!--
Smart Study Planner - Single-file Frontend
Features:
- Create / edit / delete study goals/tasks
- Set due date & time, priority, estimated duration, tags
- Mark progress (complete/partial) and visual progress bar
- LocalStorage persistence
- Simple reminder scheduling using Notification API (requests permission)
- Visual timeline (tasks shown as horizontal bars relative to the visible date range)
- Export / Import JSON
- Responsive, accessible, keyboard friendly

How to use:
1. Save this file as `smart-study-planner.html` and open in a browser.
2. For reminders: allow notifications when prompted. Reminders run while the page is open.
3. Import/Export to move data between devices.

This is a complete front-end only project (no server). All data stored in your browser's localStorage.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Study Planner</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#6ee7b7; --danger:#ff7b7b; --glass: rgba(255,255,255,0.03);
      --radius:12px; --gap:12px; --max-width:1100px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background: linear-gradient(180deg,#071021 0%, #07142a 60%); color:#e6eef6; padding:28px; display:flex; justify-content:center;
    }
    .app{width:100%; max-width:var(--max-width);}    
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .controls{display:flex; gap:8px; align-items:center}
    button{background:var(--glass); border:1px solid rgba(255,255,255,0.04); color:inherit; padding:8px 10px; border-radius:10px; cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),#60a5fa); color:#062024; font-weight:600}
    .layout{display:grid; grid-template-columns:360px 1fr; gap:18px}
    @media (max-width:900px){.layout{grid-template-columns:1fr;}}

    /* left pane */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:var(--radius); border:1px solid rgba(255,255,255,0.03)}
    form .row{display:flex; gap:8px; margin-bottom:10px}
    label{font-size:13px; color:var(--muted); display:block; margin-bottom:6px}
    input[type=text], textarea, input[type=datetime-local], select, input[type=number]{width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    textarea{min-height:72px; resize:vertical}
    .task-list{margin-top:12px; max-height:480px; overflow:auto}
    .task{display:flex; gap:10px; align-items:flex-start; padding:10px; border-radius:10px; margin-bottom:8px; background:linear-gradient(90deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006))}
    .task h3{margin:0; font-size:15px}
    .meta{font-size:12px; color:var(--muted)}
    .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:6px}
    .tag{font-size:11px; padding:4px 6px; border-radius:6px; background:rgba(255,255,255,0.02)}

    /* right pane */
    .topbar{display:flex; justify-content:space-between; gap:8px; margin-bottom:10px}
    .filters{display:flex; gap:8px; align-items:center}
    .board{display:flex; flex-direction:column; gap:12px}

    /* timeline */
    .timeline-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); padding:12px; border-radius:10px}
    .timeline{position:relative; height:160px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.006), rgba(255,255,255,0.01)); overflow:hidden}
    .timeline-grid{position:absolute; inset:0; display:flex}
    .timeline-grid .col{flex:1; border-right:1px dashed rgba(255,255,255,0.03);}
    .task-bar{position:absolute; height:28px; border-radius:8px; padding:6px 10px; display:flex; align-items:center; gap:8px; font-size:13px; box-shadow:0 4px 12px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.03)}
    .bar-complete{opacity:0.6; text-decoration:line-through}

    .progress{height:10px; background:rgba(255,255,255,0.03); border-radius:6px; overflow:hidden}
    .progress > i{display:block; height:100%; background:linear-gradient(90deg,var(--accent),#60a5fa)}

    footer{margin-top:14px; font-size:13px; color:var(--muted)}

    /* utilities */
    .small{font-size:13px}
    .muted{color:var(--muted)}
    .danger{color:var(--danger)}
    .pill{padding:6px 8px; border-radius:999px; font-size:12px}
    .flex{display:flex; align-items:center; gap:8px}

    /* accessibility focus */
    :focus{outline:3px solid rgba(96,165,250,0.15); outline-offset:2px}

  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Smart Study Planner">
    <header>
      <div>
        <h1>Smart Study Planner</h1>
        <div class="muted small">Plan, track and get reminders — all in your browser</div>
      </div>
      <div class="controls">
        <button id="exportBtn" title="Export data">Export</button>
        <button id="importBtn" title="Import data">Import</button>
        <button id="clearBtn" title="Clear all" class="danger">Clear</button>
      </div>
    </header>

    <main class="layout">
      <section class="panel" aria-label="Create task">
        <form id="taskForm">
          <div class="row">
            <div style="flex:1">
              <label for="title">Title</label>
              <input id="title" type="text" placeholder="e.g. Math: Calculus - Integration" required />
            </div>
            <div style="width:110px">
              <label for="priority">Priority</label>
              <select id="priority">
                <option value="3">High</option>
                <option value="2">Medium</option>
                <option value="1">Low</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label for="due">Due date & time</label>
              <input id="due" type="datetime-local" />
            </div>
            <div style="width:120px">
              <label for="duration">Est. hrs</label>
              <input id="duration" type="number" min="0" step="0.25" value="1" />
            </div>
          </div>

          <div>
            <label for="desc">Notes</label>
            <textarea id="desc" placeholder="Add details, chapters, links"></textarea>
          </div>

          <div class="row" style="align-items:center; margin-top:8px">
            <div style="flex:1">
              <label for="tags">Tags (comma separated)</label>
              <input id="tags" type="text" placeholder="e.g. math,week1,revision" />
            </div>
            <div style="width:150px">
              <label for="reminder">Reminder (mins before)</label>
              <input id="reminder" type="number" min="0" step="1" value="30" />
            </div>
          </div>

          <div style="display:flex; gap:8px; margin-top:10px">
            <button type="submit" class="primary">Add Goal</button>
            <button type="button" id="updateBtn" hidden>Update</button>
            <button type="reset">Reset</button>
          </div>
        </form>

        <div style="margin-top:14px; display:flex; justify-content:space-between; align-items:center">
          <div class="muted">Tasks</div>
          <div class="muted small">Double-click a task to edit • Tick to mark complete</div>
        </div>

        <div class="task-list panel-body" id="taskList" aria-live="polite"></div>
      </section>

      <section>
        <div class="panel topbar">
          <div class="filters">
            <label class="small muted">Show</label>
            <select id="viewFilter">
              <option value="all">All</option>
              <option value="active">Active</option>
              <option value="completed">Completed</option>
            </select>

            <label class="small muted">Sort</label>
            <select id="sortBy">
              <option value="due">Due Date</option>
              <option value="priority">Priority</option>
              <option value="created">Created</option>
            </select>

            <label class="small muted">Search</label>
            <input id="search" type="text" placeholder="search title, notes, tags" />
          </div>

          <div class="flex">
            <div class="muted small">Timeline range</div>
            <select id="rangeSelect">
              <option value="7">7 days</option>
              <option value="14">14 days</option>
              <option value="30" selected>30 days</option>
              <option value="90">90 days</option>
            </select>
          </div>
        </div>

        <div class="board">
          <div class="panel timeline-wrap">
            <div class="muted small" id="rangeLabel">Showing next 30 days</div>
            <div class="timeline" id="timeline" role="img" aria-label="Tasks timeline"></div>
          </div>

          <div class="panel" id="detailsPanel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
              <div><strong>Overview</strong><div class="muted small">Progress & upcoming</div></div>
              <div class="muted small" id="summaryStats">0 tasks • 0 completed</div>
            </div>
            <div style="display:flex; gap:12px; align-items:center">
              <div style="flex:1">
                <label class="small muted">Overall progress</label>
                <div class="progress" aria-hidden="true"><i id="overallProgress" style="width:0%"></i></div>
              </div>
              <div style="width:220px">
                <label class="small muted">Next upcoming</label>
                <div id="nextUp" class="muted small">—</div>
              </div>
            </div>
          </div>

          <footer>
            Tip: Use export to backup your tasks. Reminders only run while this page is open.
          </footer>
        </div>
      </section>
    </main>
  </div>

  <input id="fileInput" type="file" accept="application/json" style="display:none" />

  <script>
    (function(){
      // --- Storage key & helpers
      const STORAGE_KEY = 'ssp_tasks_v1';
      const $ = id => document.getElementById(id);

      // elements
      const taskForm = $('taskForm');
      const titleIn = $('title');
      const descIn = $('desc');
      const dueIn = $('due');
      const tagsIn = $('tags');
      const reminderIn = $('reminder');
      const priorityIn = $('priority');
      const durationIn = $('duration');
      const taskList = $('taskList');
      const exportBtn = $('exportBtn');
      const importBtn = $('importBtn');
      const clearBtn = $('clearBtn');
      const updateBtn = $('updateBtn');
      const viewFilter = $('viewFilter');
      const sortBy = $('sortBy');
      const searchIn = $('search');
      const rangeSelect = $('rangeSelect');
      const rangeLabel = $('rangeLabel');
      const timeline = $('timeline');
      const overallProgress = $('overallProgress');
      const summaryStats = $('summaryStats');
      const nextUp = $('nextUp');
      const fileInput = $('fileInput');

      // state
      let tasks = []; // array of task objects
      let editingId = null;
      let reminderTimers = new Map();

      // default sample when empty
      function sampleData(){
        return [
          {id: idGen(), title:'Math - Integration practice', desc:'Ch 5, problems 1-20', due: addDaysISO(2,'09:00'), priority:3, duration:2, tags:['math','week1'], reminder:30, created: Date.now(), done: false, progress:0},
          {id: idGen(), title:'Physics - Optics reading', desc:'Read lecture notes & summarize', due: addDaysISO(5,'18:00'), priority:2, duration:1.5, tags:['physics'], reminder:60, created: Date.now(), done: false, progress:0},
        ];
      }

      // utilities
      function idGen(){return 't_' + Math.random().toString(36).slice(2,9)}
      function nowISO(){return new Date().toISOString()}
      function parseISOLocal(v){return v?new Date(v):null}
      function formatShort(date){ if(!date) return '—'; const d=new Date(date); return d.toLocaleString(); }
      function addDaysISO(days, time){ const d = new Date(); d.setDate(d.getDate()+days); if(time){ const [hh,mm]=time.split(':'); d.setHours(Number(hh||0), Number(mm||0),0,0);} return d.toISOString(); }

      // load & save
      function load(){ const raw = localStorage.getItem(STORAGE_KEY); if(raw){ try{ tasks = JSON.parse(raw); } catch(e){ console.error('load parse',e); tasks = [] } }
        if(!tasks || !tasks.length) tasks = sampleData(); tasks.forEach(t=>{ if(!t.created) t.created = Date.now(); });
        renderAll(); scheduleAllReminders();
      }
      function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

      // create task
      taskForm.addEventListener('submit', e=>{ e.preventDefault(); const t = readForm(); if(!t) return; if(editingId){ updateTask(editingId, t); } else { addTask(t);} taskForm.reset(); titleIn.focus(); });
      function readForm(){ const title = titleIn.value.trim(); if(!title){ alert('Please add a title'); return null; }
        const t = { id: idGen(), title, desc: descIn.value.trim(), due: dueIn.value? new Date(dueIn.value).toISOString() : null, tags: tagsIn.value? tagsIn.value.split(',').map(s=>s.trim()).filter(Boolean):[], reminder: Number(reminderIn.value||0), priority: Number(priorityIn.value)||1, duration: Number(durationIn.value)||0, created: Date.now(), done:false, progress:0 };
        return t;
      }

      function addTask(task){ tasks.push(task); save(); renderAll(); scheduleReminder(task); announce('Task added'); }
      function updateTask(id, data){ const i = tasks.findIndex(t=>t.id===id); if(i===-1) return; data.id = id; data.created = tasks[i].created; data.done = tasks[i].done; data.progress = tasks[i].progress; tasks[i] = data; save(); editingId=null; updateBtn.hidden=true; renderAll(); announce('Task updated'); }

      function deleteTask(id){ if(!confirm('Delete this task?')) return; tasks = tasks.filter(t=>t.id!==id); save(); renderAll(); clearReminder(id); }

      function toggleDone(id){ const t = tasks.find(x=>x.id===id); if(!t) return; t.done = !t.done; if(t.done) t.progress = 100; else t.progress = 0; save(); renderAll(); }

      // render list
      function renderAll(){ renderList(); renderTimeline(); renderSummary(); }

      function renderList(){ taskList.innerHTML=''; const filter = viewFilter.value; const q = searchIn.value.trim().toLowerCase(); const sorted = [...tasks]; // sort
        if(sortBy.value==='due') sorted.sort((a,b)=> (a.due||'') - (b.due||''));
        if(sortBy.value==='priority') sorted.sort((a,b)=> b.priority - a.priority);
        if(sortBy.value==='created') sorted.sort((a,b)=> b.created - a.created);

        const shown = sorted.filter(t=>{
          if(filter==='active' && t.done) return false;
          if(filter==='completed' && !t.done) return false;
          if(q){ return t.title.toLowerCase().includes(q) || (t.desc||'').toLowerCase().includes(q) || (t.tags||[]).join(' ').toLowerCase().includes(q);
          }
          return true;
        });

        shown.forEach(t=>{ const el = document.createElement('div'); el.className='task'; el.tabIndex=0; el.setAttribute('data-id', t.id);
          el.innerHTML = `
            <div style="width:34px">
              <input type="checkbox" aria-label="Mark complete" ${t.done? 'checked':''} data-action="toggle" />
            </div>
            <div style="flex:1">
              <h3>${escapeHtml(t.title)}</h3>
              <div class="meta">Due: ${t.due? formatShort(t.due):'—'} • ${t.duration||0} hrs • Priority: ${pLabel(t.priority)}</div>
              ${t.tags && t.tags.length? `<div class="tags">${t.tags.map(x=>`<span class="tag">${escapeHtml(x)}</span>`).join('')}</div>`:''}
            </div>
            <div style="width:110px; text-align:right">
              <div class="small muted">${new Date(t.created).toLocaleDateString()}</div>
              <div style="margin-top:6px">
                <button data-action="edit">Edit</button>
                <button data-action="del" class="danger">Del</button>
              </div>
            </div>
          `;
          // events
          el.querySelector('[data-action="del"]').addEventListener('click', ()=>deleteTask(t.id));
          el.querySelector('[data-action="edit"]').addEventListener('click', ()=>startEdit(t.id));
          el.querySelector('input[type=checkbox]').addEventListener('change', ()=>toggleDone(t.id));
          el.addEventListener('dblclick', ()=>startEdit(t.id));
          taskList.appendChild(el);
        });
      }

      function pLabel(p){ if(p>=3) return 'High'; if(p===2) return 'Medium'; return 'Low'; }

      function startEdit(id){ const t = tasks.find(x=>x.id===id); if(!t) return; editingId = id; titleIn.value = t.title; descIn.value = t.desc || ''; dueIn.value = t.due? toInputDatetime(t.due): ''; tagsIn.value = (t.tags||[]).join(','); reminderIn.value = t.reminder||0; priorityIn.value = t.priority||1; durationIn.value = t.duration||0; updateBtn.hidden=false; window.scrollTo({top:0,behavior:'smooth'}); }
      updateBtn.addEventListener('click', ()=>{ if(!editingId) return; const data = readForm(); if(!data) return; updateTask(editingId, data); });

      function toInputDatetime(iso){ const d = new Date(iso); const local = new Date(d.getTime() - d.getTimezoneOffset()*60000); return local.toISOString().slice(0,16); }

      // timeline rendering
      function renderTimeline(){ timeline.innerHTML=''; const days = Number(rangeSelect.value || 30); rangeLabel.textContent = `Showing next ${days} days`;
        const start = new Date(); start.setHours(0,0,0,0); const end = new Date(start.getTime() + days*24*60*60*1000);
        // grid columns
        const cols = days;
        const grid = document.createElement('div'); grid.className='timeline-grid';
        for(let i=0;i<cols;i++){ const c = document.createElement('div'); c.className='col'; grid.appendChild(c); }
        timeline.appendChild(grid);

        // compute earliest and latest for scaling
        const visibleTasks = tasks.filter(t=> t.due && new Date(t.due) >= start && new Date(t.due) <= end);
        visibleTasks.forEach((t,i)=>{
          const due = new Date(t.due);
          const totalMs = end - start;
          const left = (due - start)/totalMs * 100; // position by due date
          const width = Math.max(4, (t.duration || 1)/days * 100); // small width
          const bar = document.createElement('div'); bar.className='task-bar'+(t.done? ' bar-complete':'');
          bar.style.left = left + '%'; bar.style.width = Math.min(60, width+6) + '%'; bar.title = `${t.title} — due ${formatShort(t.due)}`;
          bar.innerHTML = `<strong style="font-size:12px">${escapeHtml(t.title)}</strong>`;
          timeline.appendChild(bar);
        });
      }

      // summary
      function renderSummary(){ const total = tasks.length; const done = tasks.filter(t=>t.done).length; summaryStats.textContent = `${total} tasks • ${done} completed`;
        const avg = total? Math.round(done/total*100) : 0; overallProgress.style.width = avg + '%';
        // next upcoming
        const upcoming = tasks.filter(t=> t.due && !t.done).sort((a,b)=> new Date(a.due) - new Date(b.due))[0];
        nextUp.textContent = upcoming? `${upcoming.title} — ${formatShort(upcoming.due)}` : '—';
      }

      // reminders
      function scheduleReminder(task){ clearReminder(task.id);
        if(!task.due || typeof task.reminder !== 'number' || task.reminder < 0) return;
        const when = new Date(task.due).getTime() - (task.reminder * 60 * 1000);
        const ms = when - Date.now(); if(ms <= 0) return; // missed or immediate
        const timer = setTimeout(()=>notifyTask(task), ms);
        reminderTimers.set(task.id, timer);
      }
      function scheduleAllReminders(){ clearAllReminders(); tasks.forEach(t=> scheduleReminder(t)); }
      function clearReminder(id){ if(reminderTimers.has(id)){ clearTimeout(reminderTimers.get(id)); reminderTimers.delete(id);} }
      function clearAllReminders(){ reminderTimers.forEach(v=>clearTimeout(v)); reminderTimers.clear(); }

      function notifyTask(task){ // show browser notification
        if(Notification.permission === 'granted'){
          const n = new Notification('Reminder: ' + task.title, { body: task.desc || 'Task is coming up', silent:false });
          n.onclick = ()=> window.focus();
        } else {
          // fallback: visible alert
          alert('Reminder: ' + task.title);
        }
      }

      // schedule reminders for all tasks
      function scheduleAllReminders(){ clearAllReminders(); tasks.forEach(scheduleReminder); }

      // export / import
      exportBtn.addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify(tasks, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'smart-study-planner.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });
      importBtn.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', e=>{
        const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = ()=>{
          try{ const parsed = JSON.parse(reader.result); if(Array.isArray(parsed)){ tasks = parsed; save(); renderAll(); scheduleAllReminders(); alert('Import successful'); }else alert('Invalid file'); } catch(err){ alert('Error parsing file'); }
        }; reader.readAsText(file);
      });

      clearBtn.addEventListener('click', ()=>{ if(confirm('Clear ALL tasks? This cannot be undone.')){ tasks=[]; save(); renderAll(); clearAllReminders(); } });

      // search / filters
      [viewFilter, sortBy, searchIn, rangeSelect].forEach(el=> el.addEventListener('change', ()=>renderAll()));
      searchIn.addEventListener('input', ()=> renderAll());

      // accessibility text escaping
      function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      // small helpers
      function announce(msg){ const sr = document.createElement('div'); sr.setAttribute('role','status'); sr.style.position='absolute'; sr.style.left='-9999px'; sr.textContent = msg; document.body.appendChild(sr); setTimeout(()=>sr.remove(),2000); }

      // init notification permission
      if('Notification' in window){ if(Notification.permission === 'default'){ Notification.requestPermission().then(()=>{}); } }

      // helper: reschedule reminders when focus or visibility changes (robustness)
      document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) scheduleAllReminders(); });
      window.addEventListener('focus', scheduleAllReminders);

      // keep reminders up to date if due changed via edit
      // quick save on unload
      window.addEventListener('beforeunload', ()=> save());

      // start
      load();

    })();
  </script>
</body>
</html>
